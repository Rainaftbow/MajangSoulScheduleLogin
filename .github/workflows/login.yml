name: Majangsoul-Login
on:
  workflow_dispatch:
  schedule: #每天5:00和23:00执行
    - cron: '0 21 * * *'
    - cron: '0 15 * * *'

jobs:
  login:
    name: Majangsoul-Login
    runs-on: ubuntu-22.04
    env:
      EMAIL: ${{ secrets.EMAIL }}
      PASSWD: ${{ secrets.PASSWD }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Python 3.8
        uses: actions/setup-python@v4
        with:
          python-version: '3.8'

      - name: Install Selenium
        run: pip install selenium==4.27.1

      - name: Majangsoul login
        run: python login.py "$EMAIL" "$PASSWD"
        
      - name: Keep Alive
        run: |
            echo "Last Run: $(date)" > heartbeat.txt
            git config --local user.email "github-actions[bot]@users.noreply.github.com"
            git config --local user.name "github-actions[bot]"
            git add heartbeat.txt
            # 如果没有变化则不提交
            git commit -m "chore: workflow heartbeat [skip ci]" || exit 0
            git push
